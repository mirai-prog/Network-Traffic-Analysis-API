# Network-Traffic-Analysis-API

### 1. **Описание проекта**

FastAPI-приложение, которое позволяет загружать дампы сетевого трафика (например, PCAP-файлы), анализирует их и возвращает информацию о:

- Подозрительных IP-адресах.
- Используемых протоколах.
- Потенциальных угрозах.

### 2. **Основные функции**

1. **Загрузка файлов**:
    
    - Эндпоинт для загрузки PCAP-файла.
    - Ограничение на размер файла и проверка формата.
2. **Анализ трафика**:
    
    - Использование библиотеки Scapy для анализа пакетов.
    - Визуализация данных о типах протоколов и количестве пакетов.
3. **Отчеты**:
    
    - Эндпоинт для получения JSON-отчета с результатами анализа.
    - Информация о подозрительных IP, странных пакетах и рекомендациях.
4. **Реальное время (опционально)**:
    
    - Возможность подключить live-логирование для мониторинга пакетов в реальном времени (через WebSocket).

---

### 3. **Технологический стек**

- **FastAPI**: реализация API.
- **Scapy**: анализ сетевого трафика.
- **SQLAlchemy**: сохранение истории загрузок и анализа в базу данных.
- **Redis (опционально)**: кэширование запросов и временных данных.
- **Uvicorn**: запуск приложения.
- **Plotly/Dash**: визуализация (можно встроить графики через фронт).

---

### 4. **Структура проекта**
Для проекта **"API анализа сетевого трафика"**, архитектура должна быть модульной, масштабируемой и легко поддерживаемой. Основываясь на лучших практиках для FastAPI, предлагаю следующую архитектуру:

---

### **4.1. Общая структура проекта**
```plaintext
project/
├── app/                      # Основная логика приложения
│   ├── main.py               # Точка входа в приложение
│   ├── routers/              # Маршруты API
│   │   ├── __init__.py
│   │   ├── upload.py         # Эндпоинт загрузки файлов
│   │   ├── analysis.py       # Эндпоинт анализа файлов
│   │   ├── reports.py        # Эндпоинт генерации отчетов
│   ├── services/             # Бизнес-логика
│   │   ├── __init__.py
│   │   ├── file_service.py   # Работа с файлами (сохранение, валидация)
│   │   ├── analysis_service.py # Анализ пакетов
│   │   ├── report_service.py # Генерация отчетов
│   ├── models.py             # Модели базы данных
│   ├── schemas.py            # Pydantic-схемы для запросов и ответов
│   ├── config.py             # Настройки приложения
│   ├── utils.py              # Утилиты (общие функции)
├── tests/                    # Тесты для приложения
│   ├── __init__.py
│   ├── test_upload.py        # Тесты загрузки файлов
│   ├── test_analysis.py      # Тесты анализа трафика
│   ├── test_reports.py       # Тесты отчетов
├── data/                     # Данные для тестов (например, примеры PCAP)
│   ├── sample.pcap
├── requirements.txt          # Список зависимостей
├── README.md                 # Документация проекта
├── Dockerfile                # Конфигурация Docker
├── .env                      # Переменные окружения
```

---

### **4.2. Основные модули**
1. **`main.py`**  
   - Точка входа в приложение.  
   - Настройка FastAPI-приложения, подключение роутеров, базы данных и middlewares.  

2. **Роутеры (`routers/`)**  
   - Каждый функциональный блок имеет отдельный роутер.  
   - **`upload.py`**: обработка загрузки файлов (POST /upload).  
   - **`analysis.py`**: запуск анализа файлов (GET /analysis/{file_id}).  
   - **`reports.py`**: генерация отчетов (GET /reports/{file_id}).  

3. **Сервисы (`services/`)**  
   - Реализация всей бизнес-логики:  
     - **`file_service.py`**: проверка загружаемых файлов, сохранение и удаление.  
     - **`analysis_service.py`**: анализ трафика с использованием Scapy.  
     - **`report_service.py`**: формирование JSON-отчетов и графиков.

4. **Модели (`models.py`)**  
   - SQLAlchemy-модели для базы данных:  
     - Сохранение информации о загруженных файлах.  
     - История запросов и анализа.  

5. **Схемы (`schemas.py`)**  
   - Описание входных и выходных данных с помощью Pydantic:  
     - Запросы (например, загрузка файла).  
     - Ответы (например, результаты анализа).  

6. **Конфигурация (`config.py`)**  
   - Хранение всех настроек приложения:  
     - Путь к хранилищу файлов.  
     - Настройки базы данных.  
     - Секретные ключи (считываются из `.env`).  

---

### **4.3. Технологический стек**
- **FastAPI**: Основное приложение.  
- **SQLAlchemy/SQLite**: Для хранения данных о файлах и отчетах.  
- **Scapy**: Для анализа сетевого трафика.  
- **Plotly**: Для визуализации данных.  
- **Redis (опционально)**: Кэширование запросов и временных данных.  
- **Pytest**: Для написания тестов.  

---

### **4.4. Пример взаимодействия модулей**
1. Пользователь загружает PCAP-файл через эндпоинт `/upload`.
   - Файл проверяется в `file_service.py` и сохраняется на диск.  
   - Запись о файле сохраняется в базу данных.  

2. Пользователь запрашивает анализ файла через `/analysis/{file_id}`.  
   - Файл извлекается из хранилища.  
   - `analysis_service.py` запускает Scapy для разбора пакетов.  
   - Результаты анализа сохраняются в базу данных.

3. Пользователь запрашивает отчет через `/reports/{file_id}`.  
   - `report_service.py` формирует JSON-ответ с данными.  
   - Визуализация (если требуется) добавляется через Plotly.  

---

### 5. **Этапы разработки**

1. **Настройка FastAPI-проекта**:
    
    - Создать базовый сервер.
    - Добавить роутинг и структуру.
2. **Реализация загрузки файлов**:
    
    - Эндпоинт для загрузки файла.
    - Хранение файлов временно или в базе данных.
3. **Анализ сетевого трафика**:
    
    - Использование Scapy для разбора PCAP.
    - Создать функции для выделения IP, протоколов и аномалий.
4. **Генерация отчетов**:
    
    - Создать JSON-схему для возвращения результатов.
    - Добавить визуализацию данных (например, распределение протоколов).
5. **Тестирование и оптимизация**:
    
    - Написать тесты для API.
    - Оптимизировать обработку больших файлов.

---

### 6. **Пример API**

- **POST /upload**: загрузка PCAP-файла.
- **GET /report/{file_id}**: получить JSON-отчет.
- **GET /stats**: получить общую статистику.

---

Анализ сетевого трафика — это процесс изучения данных, передаваемых по сети, для выявления полезной информации о ее использовании, а также обнаружения аномалий, угроз или проблем. В твоем проекте анализ трафика станет центральной функцией, позволяя пользователям загружать файлы с захваченным трафиком (например, PCAP-файлы) и получать результаты в удобной форме.

---

### **Основные цели анализа сетевого трафика:**

1. **Мониторинг производительности сети**:
    
    - Изучение типов передаваемых данных (HTTP, DNS, FTP и т. д.).
    - Оценка объемов трафика и скорости передачи данных.
2. **Обнаружение угроз безопасности**:
    
    - Выявление подозрительных IP-адресов, которые могут быть источниками атак.
    - Анализ аномальных паттернов, таких как DDoS-атаки, попытки сканирования портов или внедрения вредоносного кода.
3. **Отладка сетевых проблем**:
    
    - Поиск ошибок в конфигурации сети.
    - Определение устройств, вызывающих нагрузку или сбои.
4. **Сбор информации для расследования**:
    
    - Логирование трафика помогает исследовать инциденты.
    - Анализ хронологии событий в случае сетевых атак.

---

### **Как это реализовано в проекте**

#### 1. **Использование PCAP-файлов**

Файлы PCAP (Packet Capture) содержат "снимок" сетевого трафика, который включает подробную информацию о каждом пакете:

- Источник и назначение (IP-адреса).
- Порт и протокол.
- Время передачи.
- Содержимое (например, полезная нагрузка пакета).

Пример:

```plaintext
Packet 1:
  Source IP: 192.168.1.2
  Destination IP: 93.184.216.34
  Protocol: HTTP
  Payload: GET / HTTP/1.1
```

В проекте ты будешь предоставлять API для загрузки таких файлов, а затем обрабатывать их с помощью библиотек, таких как Scapy.

---

#### 2. **Этапы анализа**

1. **Разбор пакетов**:
    
    - Извлечение данных о пакетах (IP, MAC, порты, протоколы).
    - Определение объема данных, переданных между источником и назначением.
2. **Обнаружение подозрительных активностей**:
    
    - Поиск IP-адресов, связанных с известными угрозами (черные списки).
    - Обнаружение массовых запросов (потенциальная DDoS-атака).
3. **Классификация протоколов**:
    
    - Анализ распределения протоколов (HTTP, DNS, ARP и т. д.).
    - Определение необычного использования редких протоколов.
4. **Визуализация данных**:
    
    - Создание графиков, показывающих трафик по времени, распределение IP-адресов или частоту использования протоколов.

---

#### 3. **Инструменты анализа**

- **Scapy**:  
    Python-библиотека для работы с сетевыми пакетами. Она позволяет:
    
    - Читать PCAP-файлы.
    - Извлекать данные из пакетов.
    - Определять подозрительные запросы.
- **Wireshark (опционально)**:
    
    - Используется для создания тестовых PCAP-файлов.
- **IP-черные списки**:  
    Базы данных с адресами, связанными с угрозами.
    

---

#### 4. **Результаты анализа в проекте**

Для каждого загруженного файла пользователь сможет увидеть:

- **Распределение протоколов**: какие протоколы использовались чаще всего (например, 60% HTTP, 30% DNS).
- **Список IP-адресов**: с указанием источника и назначения.
- **Подозрительные активности**: например, несколько тысяч запросов с одного IP за короткий период.


